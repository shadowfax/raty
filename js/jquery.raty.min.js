/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.4.5
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 * 
 */

(function(a){var b={init:function(c){return this.each(function(){var d=this,e=a(d).empty();d.opt=a.extend(true,{},a.fn.raty.defaults,c);e.data("settings",d.opt);d.opt.number=b.between(d.opt.number,0,20);if(d.opt.path.substring(d.opt.path.length-1,d.opt.path.length)!="/"){d.opt.path+="/"}if(typeof d.opt.score=="function"){d.opt.score=d.opt.score.call(d)}if(d.opt.score){d.opt.score=b.between(d.opt.score,0,d.opt.number)}for(var f=1;f<=d.opt.number;f++){a("<img />",{src:d.opt.path+(!d.opt.score||d.opt.score<f?d.opt.starOff:d.opt.starOn),alt:f,title:f<=d.opt.hints.length&&d.opt.hints[f-1]!==null?d.opt.hints[f-1]:f}).appendTo(d);if(d.opt.space){e.append(f<d.opt.number?"&#160;":"")}}d.stars=e.children('img:not(".raty-cancel")');d.score=a("<input />",{type:"hidden",name:d.opt.scoreName}).appendTo(d);if(d.opt.score&&d.opt.score>0){d.score.val(d.opt.score);b.roundStar.call(d,d.opt.score)}if(d.opt.iconRange){b.fill.call(d,d.opt.score)}b.setTarget.call(d,d.opt.score,d.opt.targetKeep);var g=d.opt.space?4:0,h=d.opt.width||d.opt.number*d.opt.size+d.opt.number*g;if(d.opt.cancel){d.cancel=a("<img />",{src:d.opt.path+d.opt.cancelOff,alt:"x",title:d.opt.cancelHint,"class":"raty-cancel"});if(d.opt.cancelPlace=="left"){e.prepend("&#160;").prepend(d.cancel)}else{e.append("&#160;").append(d.cancel)}h+=d.opt.size+g}if(d.opt.readOnly){b.fixHint.call(d);if(d.cancel){d.cancel.hide()}}else{e.css("cursor","pointer");b.bindAction.call(d)}e.css("width",h)})},between:function(a,b,c){return Math.min(Math.max(parseFloat(a),b),c)},bindAction:function(){var c=this,d=a(c);d.mouseleave(function(){var a=c.score.val()||undefined;b.initialize.call(c,a);b.setTarget.call(c,a,c.opt.targetKeep);if(c.opt.mouseover){c.opt.mouseover.call(c,a)}});var e=c.opt.half?"mousemove":"mouseover";if(c.opt.cancel){c.cancel.mouseenter(function(){a(this).attr("src",c.opt.path+c.opt.cancelOn);c.stars.attr("src",c.opt.path+c.opt.starOff);b.setTarget.call(c,null,true);if(c.opt.mouseover){c.opt.mouseover.call(c,null)}}).mouseleave(function(){a(this).attr("src",c.opt.path+c.opt.cancelOff);if(c.opt.mouseover){c.opt.mouseover.call(c,c.score.val()||null)}}).click(function(a){c.score.removeAttr("value");if(c.opt.click){c.opt.click.call(c,null,a)}})}c.stars.bind(e,function(e){var f=parseInt(this.alt,10);if(c.opt.half){var g=parseFloat((e.pageX-a(this).offset().left)/c.opt.size),h=g>.5?1:.5;f=parseFloat(this.alt)-1+h;b.fill.call(c,f);if(c.opt.precision){f=f-h+g}b.showHalf.call(c,f)}else{b.fill.call(c,f)}d.data("score",f);b.setTarget.call(c,f,true);if(c.opt.mouseover){c.opt.mouseover.call(c,f,e)}}).click(function(a){c.score.val(c.opt.half||c.opt.precision?d.data("score"):this.alt);if(c.opt.click){c.opt.click.call(c,c.score.val(),a)}})},cancel:function(c){return a(this).each(function(){var d=this,e=a(d);if(e.data("readonly")===true){return this}if(c){b.click.call(d,null)}else{b.score.call(d,null)}d.score.removeAttr("value")})},click:function(c){return a(this).each(function(){if(a(this).data("readonly")===true){return this}b.initialize.call(this,c);if(this.opt.click){this.opt.click.call(this,c)}else{b.error.call(this,'you must add the "click: function(score, evt) { }" callback.')}b.setTarget.call(this,c,true)})},error:function(b){a(this).html(b);a.error(b)},fill:function(a){var b=this,c=b.stars.length,d=0,e,f,g;for(var h=1;h<=c;h++){e=b.stars.eq(h-1);if(b.opt.iconRange&&b.opt.iconRange.length>d){f=b.opt.iconRange[d];if(b.opt.single){g=h==a?f.on||b.opt.starOn:f.off||b.opt.starOff}else{g=h<=a?f.on||b.opt.starOn:f.off||b.opt.starOff}if(h<=f.range){e.attr("src",b.opt.path+g)}if(h==f.range){d++}}else{if(b.opt.single){g=h==a?b.opt.starOn:b.opt.starOff}else{g=h<=a?b.opt.starOn:b.opt.starOff}e.attr("src",b.opt.path+g)}}},fixHint:function(){var b=a(this),c=parseInt(Math.ceil(this.score.val()),10),d=this.opt.noRatedMsg;if(!isNaN(c)&&c>0){d=c<=this.opt.hints.length&&this.opt.hints[c-1]!==null?this.opt.hints[c-1]:c}b.data("readonly",true).css("cursor","default").attr("title",d);this.score.attr("readonly","readonly");this.stars.attr("title",d)},getScore:function(){var b=[],c;a(this).each(function(){c=this.score.val();b.push(c?parseFloat(c):undefined)});return b.length>1?b:b[0]},readOnly:function(c){return this.each(function(){var d=a(this);if(d.data("readonly")===c){return this}if(this.cancel){if(c){this.cancel.hide()}else{this.cancel.show()}}if(c){d.unbind();d.children("img").unbind();b.fixHint.call(this)}else{b.bindAction.call(this);b.unfixHint.call(this)}d.data("readonly",c)})},reload:function(){return b.set.call(this,{})},roundStar:function(a){var b=(a-Math.floor(a)).toFixed(2);if(b>this.opt.round.down){var c=this.opt.starOn;if(b<this.opt.round.up&&this.opt.halfShow){c=this.opt.starHalf}else if(b<this.opt.round.full){c=this.opt.starOff}this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+c)}},score:function(){return arguments.length?b.setScore.apply(this,arguments):b.getScore.call(this)},set:function(b){this.each(function(){var c=a(this),d=c.data("settings"),e=c.clone().removeAttr("style").insertBefore(c);c.remove();e.raty(a.extend(d,b))});return a(this.selector)},setScore:function(c){return a(this).each(function(){if(a(this).data("readonly")===true){return this}b.initialize.call(this,c);b.setTarget.call(this,c,true)})},setTarget:function(c,d){if(this.opt.target){var e=a(this.opt.target);if(e.length==0){b.error.call(this,"target selector invalid or missing!")}var f=c;if(!d||f===undefined){f=this.opt.targetText}else{if(this.opt.targetType=="hint"){f=f===null&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(f-1)]}else{f=this.opt.precision?parseFloat(f).toFixed(1):parseInt(f,10)}}if(this.opt.targetFormat.indexOf("{score}")<0){b.error.call(this,'template "{score}" missing!')}if(c!==null){f=this.opt.targetFormat.toString().replace("{score}",f)}if(e.is(":input")){e.val(f)}else{e.html(f)}}},showHalf:function(a){var b=(a-Math.floor(a)).toFixed(1);if(b>0&&b<.6){this.stars.eq(Math.ceil(a)-1).attr("src",this.opt.path+this.opt.starHalf)}},initialize:function(a){a=!a?0:b.between(a,0,this.opt.number);b.fill.call(this,a);if(a>0){if(this.opt.halfShow){b.roundStar.call(this,a)}this.score.val(a)}},unfixHint:function(){for(var b=0;b<this.opt.number;b++){this.stars.eq(b).attr("title",b<this.opt.hints.length&&this.opt.hints[b]!==null?this.opt.hints[b]:b)}a(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.attr("readonly","readonly")}};a.fn.raty=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist!")}};a.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseover:undefined,noRatedMsg:"not rated yet",number:5,path:"img/",precision:false,round:{down:.25,full:.6,up:.76},readOnly:false,score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery)
